(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):b(jQuery)})(function(b){var j=[],k=b(document),l=b.browser.msie&&6===parseInt(b.browser.version)&&"object"!==typeof window.XMLHttpRequest,n=b.browser.msie&&7===parseInt(b.browser.version),m=null,h=b(window),i=[];b.modal=function(a,d){return b.modal.impl.init(a,d)};b.modal.close=function(){b.modal.impl.close()};b.modal.focus=function(a){b.modal.impl.focus(a)};b.modal.setContainerDimensions=function(){b.modal.impl.setContainerDimensions()};b.modal.setPosition=function(){b.modal.impl.setPosition()};b.modal.update=function(a,d){b.modal.impl.update(a,d)};b.fn.modal=function(a){return b.modal.impl.init(this,a)};b.modal.defaults={appendTo:"body",focus:!0,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:!1,autoPosition:!0,zIndex:1E3,close:!0,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:!0,overlayClose:!1,fixed:!0,position:null,persist:!1,modal:!0,onOpen:null,onShow:null,onClose:null};b.modal.impl={d:{},init:function(a,d){if(this.d.data)return!1;m=b.browser.msie&&!b.boxModel;this.o=b.extend({},b.modal.defaults,d);this.zIndex=this.o.zIndex;this.occb=!1;if("object"===typeof a){if(a=a instanceof jQuery?a:b(a),this.d.placeholder=!1,0<a.parent().parent().size()&&(a.before(b("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"})),this.d.placeholder=!0,this.display=a.css("display"),!this.o.persist))this.d.orig=a.clone(!0)}else if("string"===typeof a||"number"===typeof a)a=b("<div></div>").html(a);else return alert("SimpleModal Error: Unsupported data type: "+typeof a),this;this.create(a);this.open();b.isFunction(this.o.onShow)&&this.o.onShow.apply(this,[this.d]);return this},create:function(a){this.getDimensions();if(this.o.modal&&l)this.d.iframe=b('<iframe src="javascript:false;"></iframe>').css(b.extend(this.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:i[0],width:i[1],zIndex:this.o.zIndex,top:0,left:0})).appendTo(this.o.appendTo);this.d.overlay=b("<div></div>").attr("id",this.o.overlayId).addClass("simplemodal-overlay").css(b.extend(this.o.overlayCss,{display:"none",opacity:this.o.opacity/100,height:this.o.modal?j[0]:0,width:this.o.modal?j[1]:0,position:"fixed",left:0,top:0,zIndex:this.o.zIndex+1})).appendTo(this.o.appendTo);this.d.container=b("<div></div>").attr("id",this.o.containerId).addClass("simplemodal-container").css(b.extend({position:this.o.fixed?"fixed":"absolute"},this.o.containerCss,{display:"none",zIndex:this.o.zIndex+2})).append(this.o.close&&this.o.closeHTML?b(this.o.closeHTML).addClass(this.o.closeClass):"").appendTo(this.o.appendTo);this.d.wrap=b("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(this.d.container);this.d.data=a.attr("id",a.attr("id")||this.o.dataId).addClass("simplemodal-data").css(b.extend(this.o.dataCss,{display:"none"})).appendTo("body");this.setContainerDimensions();this.d.data.appendTo(this.d.wrap);(l||m)&&this.fixIE()},bindEvents:function(){var a=this;b("."+a.o.closeClass).bind("click.simplemodal",function(b){b.preventDefault();a.close()});a.o.modal&&a.o.close&&a.o.overlayClose&&a.d.overlay.bind("click.simplemodal",function(b){b.preventDefault();a.close()});k.bind("keydown.simplemodal",function(b){a.o.modal&&9===b.keyCode?a.watchTab(b):a.o.close&&a.o.escClose&&27===b.keyCode&&(b.preventDefault(),a.close())});h.bind("resize.simplemodal orientationchange.simplemodal",function(){a.getDimensions();a.o.autoResize?a.setContainerDimensions():a.o.autoPosition&&a.setPosition();l||m?a.fixIE():a.o.modal&&(a.d.iframe&&a.d.iframe.css({height:i[0],width:i[1]}),a.d.overlay.css({height:j[0],width:j[1]}))})},unbindEvents:function(){b("."+this.o.closeClass).unbind("click.simplemodal");k.unbind("keydown.simplemodal");h.unbind(".simplemodal");this.d.overlay.unbind("click.simplemodal")},fixIE:function(){var a=this.o.position;b.each([this.d.iframe||null,!this.o.modal?null:this.d.overlay,"fixed"===this.d.container.css("position")?this.d.container:null],function(b,f){if(f){var g=f[0].style;g.position="absolute";if(2>b)g.removeExpression("height"),g.removeExpression("width"),g.setExpression("height",'document.body.scrollHeight > document.body.clientHeight ? document.body.scrollHeight : document.body.clientHeight + "px"'),g.setExpression("width",'document.body.scrollWidth > document.body.clientWidth ? document.body.scrollWidth : document.body.clientWidth + "px"');else{var c,e;a&&a.constructor===Array?(c=a[0]?"number"===typeof a[0]?a[0].toString():a[0].replace(/px/,""):f.css("top").replace(/px/,""),c=-1===c.indexOf("%")?c+' + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"':parseInt(c.replace(/%/,""))+' * ((document.documentElement.clientHeight || document.body.clientHeight) / 100) + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"',a[1]&&(e="number"===typeof a[1]?a[1].toString():a[1].replace(/px/,""),e=-1===e.indexOf("%")?e+' + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"':parseInt(e.replace(/%/,""))+' * ((document.documentElement.clientWidth || document.body.clientWidth) / 100) + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"')):(c='(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"',e='(document.documentElement.clientWidth || document.body.clientWidth) / 2 - (this.offsetWidth / 2) + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"');g.removeExpression("top");g.removeExpression("left");g.setExpression("top",c);g.setExpression("left",e)}}})},focus:function(a){var d=this,a=a&&-1!==b.inArray(a,["first","last"])?a:"first",f=b(":input:enabled:visible:"+a,d.d.wrap);setTimeout(function(){0<f.length?f.focus():d.d.wrap.focus()},10)},getDimensions:function(){var a=b.browser.opera&&"9.5"<b.browser.version&&"1.3">b.fn.jquery||b.browser.opera&&"9.5">b.browser.version&&"1.2.6"<b.fn.jquery?h[0].innerHeight:h.height();j=[k.height(),k.width()];i=[a,h.width()]},getVal:function(a,b){return a?"number"===typeof a?a:"auto"===a?0:0<a.indexOf("%")?parseInt(a.replace(/%/,""))/100*("h"===b?i[0]:i[1]):parseInt(a.replace(/px/,"")):null},update:function(a,b){if(!this.d.data)return!1;this.d.origHeight=this.getVal(a,"h");this.d.origWidth=this.getVal(b,"w");this.d.data.hide();a&&this.d.container.css("height",a);b&&this.d.container.css("width",b);this.setContainerDimensions();this.d.data.show();this.o.focus&&this.focus();this.unbindEvents();this.bindEvents()},setContainerDimensions:function(){var a=l||n,d=this.d.origHeight?this.d.origHeight:b.browser.opera?this.d.container.height():this.getVal(a?this.d.container[0].currentStyle.height:this.d.container.css("height"),"h"),a=this.d.origWidth?this.d.origWidth:b.browser.opera?this.d.container.width():this.getVal(a?this.d.container[0].currentStyle.width:this.d.container.css("width"),"w"),f=this.d.data.outerHeight(!0),g=this.d.data.outerWidth(!0);this.d.origHeight=this.d.origHeight||d;this.d.origWidth=this.d.origWidth||a;var c=this.o.maxHeight?this.getVal(this.o.maxHeight,"h"):null,e=this.o.maxWidth?this.getVal(this.o.maxWidth,"w"):null,c=c&&c<i[0]?c:i[0],e=e&&e<i[1]?e:i[1],h=this.o.minHeight?this.getVal(this.o.minHeight,"h"):"auto",d=d?this.o.autoResize&&d>c?c:d<h?h:d:f?f>c?c:this.o.minHeight&&"auto"!==h&&f<h?h:f:h,c=this.o.minWidth?this.getVal(this.o.minWidth,"w"):"auto",a=a?this.o.autoResize&&a>e?e:a<c?c:a:g?g>e?e:this.o.minWidth&&"auto"!==c&&g<c?c:g:c;this.d.container.css({height:d,width:a});this.d.wrap.css({overflow:f>d||g>a?"auto":"visible"});this.o.autoPosition&&this.setPosition()},setPosition:function(){var a,b;a=i[0]/2-this.d.container.outerHeight(!0)/2;b=i[1]/2-this.d.container.outerWidth(!0)/2;var f="fixed"!==this.d.container.css("position")?h.scrollTop():0;this.o.position&&"[object Array]"===Object.prototype.toString.call(this.o.position)?(a=f+(this.o.position[0]||a),b=this.o.position[1]||b):a=f+a;this.d.container.css({left:b,top:a})},watchTab:function(a){if(0<b(a.target).parents(".simplemodal-container").length){if(this.inputs=b(":input:enabled:visible:first, :input:enabled:visible:last",this.d.data[0]),!a.shiftKey&&a.target===this.inputs[this.inputs.length-1]||a.shiftKey&&a.target===this.inputs[0]||0===this.inputs.length)a.preventDefault(),this.focus(a.shiftKey?"last":"first")}else a.preventDefault(),this.focus()},open:function(){this.d.iframe&&this.d.iframe.show();b.isFunction(this.o.onOpen)?this.o.onOpen.apply(this,[this.d]):(this.d.overlay.show(),this.d.container.show(),this.d.data.show());this.o.focus&&this.focus();this.bindEvents()},close:function(){if(!this.d.data)return!1;this.unbindEvents();if(b.isFunction(this.o.onClose)&&!this.occb)this.occb=!0,this.o.onClose.apply(this,[this.d]);else{if(this.d.placeholder){var a=b("#simplemodal-placeholder");this.o.persist?a.replaceWith(this.d.data.removeClass("simplemodal-data").css("display",this.display)):(this.d.data.hide().remove(),a.replaceWith(this.d.orig))}else this.d.data.hide().remove();this.d.container.hide().remove();this.d.overlay.hide();this.d.iframe&&this.d.iframe.hide().remove();this.d.overlay.remove();this.d={}}}}});;$=jQuery;var menuDown=0;$(document).ready(function(){if(is_touch_device()){$('#main-menu ul li.expanded a').on("touchstart MSPointerDown",function(e){if(!menuDown){e.preventDefault();$(this).parent().find('ul.menu').show();menuDown=1;}
else menuDown=0;});}
var countryCode=readCookie('iso');if(!countryCode||countryCode==""||countryCode==null){$.ajax({url:'https://cfwk.savethechildren.ngo/api/geo/country',timeout:3000,jsonp:"callback",jsonpCallback:"setDropCountry",dataType:"jsonp"}).done(function(json){countryCode=json.country_code;createCookie('iso',countryCode,2);selectOption(countryCode);}).fail(function(){$.getJSON('/webservices/geo/ajax.php?callback=?',function(json){countryCode=json.country;createCookie('iso',countryCode,2);selectOption(countryCode);})})}
else selectOption(countryCode);$('.redirect button').click(function(e){e.preventDefault();var val=$(this).parent().parent().find('select').val();if(val!=""){if(window.ga&&ga.create){ga('send',{hitType:'event',eventCategory:"Outbound links",eventAction:"drop-down",eventLabel:val,});}
window.location.href=val;$.modal.close();}})
$('#block-system-main .field-name-body img').each(function(i,v){if(!$(this).attr('alt'))return false;var width=$(this).attr('width')+"px";if($(this).parent().is('p')){$(this).unwrap();}
var wrapper=$(this).wrap('<div class="image-wrapper" style="width: '+width+'"/>')
$(this).parent().append('<span class="caption">'+$(this).attr('alt')+'</span>');if($(this).hasClass('left-align'))$(this).removeClass('left-align').parent().addClass('left-align');})
$('a.modal').click(function(e){e.preventDefault();var div=$(this).attr('href');$(''+div).modal({opacity:70});})
var cookieAccepted=readCookie('cookie-law');if(!cookieAccepted){var div=$('<div id="cookie-law" class="element-hidden"><div class="section">This site uses cookies. By continuing to browse the site you are agreeing to our use of cookies <a href="/cookie-policy">Find out more here</a><i title="Close" class="icon icon-white icon-remove-sign"></i></div></div>');$(div).prependTo($('#page-wrapper'));$('#cookie-law').slideDown();$('#cookie-law i').click(function(){$('#cookie-law').slideUp();})
createCookie('cookie-law','Accepted');}
var numitems=$('#featured .frame').length;$('#featured .frames').css('width',(980*numitems)+'px');$('#featured').prepend($('<div/>').addClass('mask'));$('featured .frame:first').addClass('active');selectFrame(0);$('#featured-nav li').click(function(e){var index=$(this).index();e.preventDefault();selectFrame(index);startCarousel();})
startCarousel();$('#featured').hover(function(){stopCarousel();},function(){startCarousel();})
$("#chart_div iframe").ready(function(){var to=window.setTimeout(onready,3000);function onready(){var c=$('#chart_div iframe').contents();$('#chart_div iframe').contents().bind('DOMNodeInserted',function(e){$(e.target).find('text').each(function(){if($(this).text()=="Presence:"){$(this).parent().hide();}})})}})
if(typeof twitterobj!='undefined')twitter(twitterobj);var slide_num=0;var cur_num=0;var slide_int=false;if(typeof sowm_set!='undefined'){$.getJSON("http://api.flickr.com/services/rest/?api_key=f1b076b8b7cdc72f84b2e6adb28f7e10&format=json&jsoncallback=?&method=flickr.photosets.getPhotos&photoset_id="+sowm_set,function(json){slide_num=json.photoset.photo.length;$.each(json.photoset.photo,function(i,v){$.getJSON("http://api.flickr.com/services/rest/?api_key=f1b076b8b7cdc72f84b2e6adb28f7e10&format=json&jsoncallback=?&method=flickr.photos.getInfo&photo_id="+v.id,function(info){cur_num++;$('#slides').append('<li><img src="http://farm'+info.photo.farm+'.staticflickr.com/'+info.photo.server+'/'+info.photo.id+'_'+info.photo.secret+'_z.jpg" alt="'+info.photo.title._content+'" /><div><h3>'+info.photo.title._content+'</h3><p>'+info.photo.description._content+'</p></div></li>');if(cur_num==slide_num){slide_int=window.setInterval(nextSlide,8*1000);$('#slides li div').on('mouseenter',function(){$(this).find('p:hidden').slideDown(200);window.clearInterval(slide_int);})
$('#slides li div').on('mouseleave',function(){$(this).find('p:visible').slideUp(200);slide_int=window.setInterval(nextSlide,8*1000);})}})})})}
function nextSlide(){$('#slides').animate({marginLeft:'-600px'},function(){$(this).find('li:first').appendTo($('#slides'));$('#slides').css('marginLeft','0');});}})
function selectOption(iso){$('select.member-select').each(function(i,v){$(this).find('option').each(function(i2,v2){if($(this).attr('title')==iso){$(this).attr('selected','selected');return false;}})})}
var carousel=null;function showSub(index){$('#submenu ul').hide();$('#submenu, #submenu ul:eq('+index+')').show();}
function subPreselect(){$('#submenu').hide();$('#submenu ul').each(function(i,v){if($(this).hasClass('active-trail')){showSub(i);}})}
function selectFrame(index){$('#featured .mask').html($('#featured .frame.active').html());$('#featured .mask').show().fadeOut('slow');$('#featured .frames').css({'margin-left':(index*-980)+'px'});$('#featured .frame').removeClass('active').eq(index).addClass('active');$('#featured-nav li').removeClass('active');$('#featured-nav li:eq('+index+')').addClass('active');}
function startCarousel(){window.clearInterval(carousel);carousel=window.setInterval(selectNextFrame,8000);}
function selectNextFrame(){var curindex=$('#featured-nav li.active').index();var total=$('#featured-nav li').length;var newindex=(curindex<total-1?curindex+1:0);selectFrame(newindex);}
function stopCarousel(){window.clearInterval(carousel);}
function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString();}
else var expires="";document.cookie=name+"="+value+expires+"; path=/";}
function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
return null;}
function twitter(twitterobj){var html="";var surl="https://twitter.com/search?q=";var aurl="https://twitter.com/";$.getJSON("/webservices/getfeed.php?list_id="+twitterobj.list+"&user="+twitterobj.user+"&max="+twitterobj.max,function(json){if(json.error||json.errors){$('#twitter_feed').parent().parent().hide();return false;}
$.each(json,function(i,v){var container=$("<div/>").addClass("twtr-tweet");var avatar=$("<img/>");var link=$("<a/>");var actions=$("<div/>").addClass("footer clearfix");var text=$("<div/>").addClass("text");var tweet=v.text;var patt=/http\:\/\/[^\s]+/gi;var results=Array();while((myArray=patt.exec(tweet))!==null){results.push(myArray[0]);}
if(results){$.each(results,function(i2,v2){tweet=tweet.replace(v2,'<a target="_blank" href="'+v2+'">'+v2+"</a>");})}
var patt=/@\w+/gi;var results=Array();while((myArray=patt.exec(tweet))!==null){results.push(myArray[0]);}
if(results){$.each(results,function(i2,v2){tweet=tweet.replace(v2,'<a target="_blank" href="'+aurl+v2.substr(1)+'">'+v2+"</a>");})}
var patt=/#\w+/gi;var results=Array();while((myArray=patt.exec(tweet))!==null){results.push(myArray[0]);}
if(results){$.each(results,function(i2,v2){tweet=tweet.replace(v2,'<a target="_blank" href="'+surl+encodeURIComponent(v2)+'">'+v2+"</a>");})}
$(link).attr({target:'_blank',href:"https://twitter.com/intent/user?screen_name="+v.user.screen_name});$(avatar).attr({src:v.user.profile_image_url_https});$(container).attr('id',"tweet-id-"+i).append($(link).clone().append($(avatar)));var d=parseDate(v.created_at);d=d.getTime();var now=new Date().getTime();var dif=Math.round((now-d)/1000);var time="";if(dif<60)time=(dif>1?dif+" seconds":dif+" second")+" ago";else if(dif<60*60)time=(Math.floor(dif/60)>1?Math.floor(dif/60)+" minutes":Math.floor(dif/60)+" minute")+" ago";else if(dif<24*60*60)time=(Math.floor(dif/(60*60))>1?Math.floor(dif/(60*60))+" hours":Math.floor(dif/(60*60))+" hour")+" ago";else if(dif<48*60*60)time="Yesterday";else time=v.created_at.replace(/\d\d\:.+/gi,"");$(actions).append('<ul><li><a target="_blank" href="'+aurl+'intent/status/'+v.id_str+'">'+time+'</a></li>'+
'<li><a target="_blank" title="Reply" class="icon reply" href="'+aurl+'intent/tweet?in_reply_to='+v.id_str+'"></a></li>'+
'<li><a target="_blank" title="Retweet" class="icon retweet" href="'+aurl+'intent/retweet?tweet_id='+v.id_str+'"></a></li>'+
'<li><a target="_blank" title="Favorite" class="icon favorite" href="'+aurl+'intent/favorite?tweet_id='+v.id_str+'"></a></li></ul>');$(text).append($(link).html(v.user.screen_name));$(text).append(" "+tweet);$(container).append($(text)).append($(actions));$('#twitter_feed').append($(container));})})}
function parseDate(str){var v=str.split(' ');return new Date(Date.parse(v[1]+" "+v[2]+", "+v[5]+" "+v[3]+" UTC"));}
function is_touch_device(){return "ontouchstart"in window||navigator.msMaxTouchPoints;};